pipeline {
    agent any
	tools {
		maven 'localMAVEN'
	}
    parameters{
		string(name: 'tomcat_dev', defaultValue: 'localhost:8090', description: 'staging server')
		string(name: 'tomcat_prod', defaultValue: 'localhost:8081', description: 'production server')
	}
	triggers{
		pollSCM('* * * * *')
	}
	stages{
		stage('Build'){
			steps{
				bat "mvn clean package"
			}
			post{
				success{
					echo 'Now Archiving...'
					archiveArtifacts artifacts: '**/*.war'
				}
			}
		}
		stage('Deployments'){
			parallel{
				stage('Deploy to Staging'){
					steps{
						bat "cp -i **/*.war @${params:tomcat_dev}/webapps"
					}
				}
				stage('Deploy to Production'){
					steps{
						bat "cp -i **/*.war @${parms:tomcat_prod}/webapps"
					}
				}
			}
		}
	}
	
}
